<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
  <meta name="theme-color" content="#495057">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>HTMLÁ®ãÂºèÁ¢ºÊ≤ôÁõí</title>
  <style>
    :root {
      --color-main: #495057;
      --color-gray: #adb5bd;
      --color-light: #e9ecef;
      --color-bg: #f5f5f5;
      --color-white: #fff;
      --color-gold: #ffc107;
      --radius: 6px;
      --gap: 8px;
      --btn-h: 36px;
      --trans: 0.2s ease;
    }
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    html, body { 
      width: 100%; 
      height: 100%; 
    }
    body {
      background: var(--color-bg);
      font-family: -apple-system, "Segoe UI", "Microsoft JhengHei", sans-serif;
      color: var(--color-main);
      font-size: 14px;
    }
    .app-header {
      display: flex;
      align-items: center;
      background: var(--color-white);
      border-bottom: 1px solid var(--color-light);
      padding: 0 var(--gap);
      height: 52px;
      gap: var(--gap);
      flex-shrink: 0;
    }
    .app-logo {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 1.5px;
      color: var(--color-main);
      animation: bounce 1s infinite alternate;
    }
    @keyframes bounce {
      0% { transform: translateY(0); }
      100% { transform: translateY(-4px); }
    }
    .tab-bar {
      display: flex;
      gap: var(--gap);
      flex: 1;
      margin-left: var(--gap);
    }
    .tab-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: var(--btn-h);
      min-width: 90px;
      font-size: 13px;
      border: none;
      border-radius: var(--radius);
      background: var(--color-light);
      color: var(--color-main);
      font-weight: 500;
      cursor: pointer;
      transition: background var(--trans);
      padding: 0 12px;
    }
    .tab-btn:active {
      transform: scale(0.98);
    }
    .tab-btn.active {
      background: var(--color-gray);
      color: var(--color-white);
    }
    .main-area {
      width: 100vw;
      height: calc(100vh - 52px);
      display: flex;
      flex-direction: column;
      background: var(--color-bg);
      position: relative;
      overflow: hidden;
    }
    .panel {
      display: none;
      flex-direction: column;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
    }
    .panel.active {
      display: flex;
    }
    .func-bar {
      background: var(--color-gray);
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 var(--gap);
      height: 44px;
      border-radius: var(--radius) var(--radius) 0 0;
      gap: var(--gap);
      flex-shrink: 0;
    }
    .func-btn-group {
      display: flex;
      gap: var(--gap);
      align-items: center;
    }
    .func-btn {
      background: var(--color-light);
      color: var(--color-main);
      border: none;
      border-radius: var(--radius);
      font-size: 12px;
      font-weight: 500;
      height: 32px;
      min-width: 50px;
      padding: 0 10px;
      cursor: pointer;
      transition: background var(--trans);
      white-space: nowrap;
    }
    .func-btn:active { 
      background: var(--color-main);
      color: var(--color-white);
      transform: scale(0.98);
    }
    .pin-btn {
      width: 32px;
      height: 32px;
      padding: 0;
      border-radius: 50%;
      background: var(--color-light);
      border: 2px solid transparent;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--trans);
      margin-right: auto;
    }
    .pin-btn:active {
      transform: scale(0.95);
    }
    .pin-btn.active {
      background: var(--color-gold);
      color: var(--color-main);
      box-shadow: 0 2px 6px rgba(255, 193, 7, 0.4);
    }
    .content-area {
      background: var(--color-white);
      border-radius: 0 0 var(--radius) var(--radius);
      flex: 1;
      padding: var(--gap);
      overflow: auto;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    .preview-bar {
      background: var(--color-gray);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--gap);
      height: 44px;
      border-radius: var(--radius) var(--radius) 0 0;
      color: var(--color-white);
      font-weight: 500;
      font-size: 13px;
      flex-shrink: 0;
    }
    .history-bar {
      background: var(--color-gray);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--gap);
      height: 44px;
      border-radius: var(--radius) var(--radius) 0 0;
      color: var(--color-white);
      font-weight: 500;
      font-size: 13px;
      flex-shrink: 0;
    }
    textarea {
      width: 100%;
      flex: 1;
      border-radius: var(--radius);
      font-size: 13px;
      border: 1px solid #e0e0e0;
      padding: 10px;
      resize: none;
      font-family: 'Courier New', monospace;
      outline: none;
      transition: border-color var(--trans);
    }
    textarea:focus {
      border-color: var(--color-gray);
    }
    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
      flex: 1;
      overflow-y: auto;
    }
    .history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--color-light);
      transition: background var(--trans);
    }
    .history-item:hover {
      background: #f9f9f9;
    }
    .history-info {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 0;
      gap: 3px;
    }
    .history-title {
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .history-meta {
      color: #999;
      font-size: 11px;
    }
    .history-actions {
      display: flex;
      gap: var(--gap);
      align-items: center;
      flex-shrink: 0;
    }
    .iframe-preview {
      width: 100%;
      flex: 1;
      border: 1px solid #e0e0e0;
      border-radius: var(--radius);
    }
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #ccc;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="app-header">
    <span class="app-logo">HTML</span>
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="0">Á∑®ËºØ</button>
      <button class="tab-btn" data-tab="1">È†êË¶Ω</button>
      <button class="tab-btn" data-tab="2">Á¥ÄÈåÑ</button>
    </div>
  </div>
  
  <div class="main-area" id="mainArea">
    <!-- Á∑®ËºØÈ†Å -->
    <div class="panel active" id="panel-0">
      <div class="func-bar">
        <button class="pin-btn" id="pinBtn">üìç</button>
        <div class="func-btn-group">
          <button class="func-btn" id="pasteBtn">Ë≤º‰∏ä</button>
          <button class="func-btn" id="copyBtn">Ë§áË£Ω</button>
          <button class="func-btn" id="clearBtn">Ê∏ÖÁ©∫</button>
          <button class="func-btn" id="runBtn">Âü∑Ë°å</button>
        </div>
      </div>
      <div class="content-area">
        <textarea id="codeInput" placeholder="Âú®Ê≠§Ë≤º‰∏äHTML..."></textarea>
      </div>
    </div>

    <!-- È†êË¶ΩÈ†Å -->
    <div class="panel" id="panel-1">
      <div class="preview-bar">
        <span>Âç≥ÊôÇÈ†êË¶Ω</span>
        <button class="func-btn" id="refreshBtn">Âà∑Êñ∞</button>
      </div>
      <div class="content-area">
        <iframe id="previewFrame" class="iframe-preview" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals allow-presentation"></iframe>
      </div>
    </div>

    <!-- Ê≠∑Âè≤È†Å -->
    <div class="panel" id="panel-2">
      <div class="history-bar">
        <span>Ê≠∑Âè≤Á¥ÄÈåÑ</span>
        <button class="func-btn" id="clearAllHistoryBtn">Ê∏ÖÁ©∫</button>
      </div>
      <div class="content-area">
        <ul class="history-list" id="historyList"></ul>
      </div>
    </div>
  </div>

  <script>
    // ========== DOM ÂÖÉÁ¥† ==========
    const codeInput = document.getElementById('codeInput');
    const previewFrame = document.getElementById('previewFrame');
    const pinBtn = document.getElementById('pinBtn');
    const mainArea = document.getElementById('mainArea');
    const historyList = document.getElementById('historyList');

    let currentTab = 0;
    let isPinned = false;
    let touchStartX = 0;

    // ========== Tab ÈªûÊìäÂàáÊèõ ==========
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.onclick = function() {
        const tabIndex = parseInt(this.getAttribute('data-tab'));
        switchTab(tabIndex);
      };
    });

    function switchTab(tabIndex) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      
      document.querySelectorAll('.tab-btn')[tabIndex].classList.add('active');
      document.getElementById(`panel-${tabIndex}`).classList.add('active');
      
      currentTab = tabIndex;
      
      if (tabIndex === 1) {
        setTimeout(() => runCode(), 100);
      }
    }

    // ========== ÊªëÂãïÂàáÊèõ ==========
    mainArea.ontouchstart = function(e) {
      touchStartX = e.touches[0].clientX;
    };

    mainArea.ontouchend = function(e) {
      const touchEndX = e.changedTouches[0].clientX;
      const diff = touchStartX - touchEndX;
      if (Math.abs(diff) > 50) {
        if (diff > 0 && currentTab < 2) switchTab(currentTab + 1);
        if (diff < 0 && currentTab > 0) switchTab(currentTab - 1);
      }
    };

    // ========== Èáò‰ΩèÂäüËÉΩ ==========
    function updatePinBtn() {
      if (isPinned) {
        pinBtn.classList.add('active');
        pinBtn.title = 'ÂèñÊ∂àÈáò‰Ωè';
      } else {
        pinBtn.classList.remove('active');
        pinBtn.title = 'Èáò‰Ωè';
      }
    }

    pinBtn.onclick = function() {
      isPinned = !isPinned;
      updatePinBtn();
      if (isPinned) {
        localStorage.setItem('htmlSandbox_pinned', codeInput.value);
      } else {
        localStorage.removeItem('htmlSandbox_pinned');
      }
    };

    // ÂàùÂßãËºâÂÖ•Èáò‰Ωè‰ª£Á¢º
    const pinnedCode = localStorage.getItem('htmlSandbox_pinned');
    if (pinnedCode) {
      codeInput.value = pinnedCode;
      isPinned = true;
      updatePinBtn();
    }

    // ========== Âü∑Ë°å‰ª£Á¢º ==========
    function runCode() {
      const code = codeInput.value;
      previewFrame.srcdoc = code;
      if (isPinned) {
        localStorage.setItem('htmlSandbox_pinned', code);
      }
      addToHistory(code);
    }

    document.getElementById('runBtn').onclick = runCode;
    document.getElementById('refreshBtn').onclick = runCode;

    // ========== Ë≤º‰∏äÂäüËÉΩ ==========
    document.getElementById('pasteBtn').onclick = async function() {
      try {
        const text = await navigator.clipboard.readText();
        codeInput.value = text;
        switchTab(1);
        setTimeout(runCode, 100);
      } catch (e) {
        alert("Ââ™Ë≤ºÁ∞øÂ≠òÂèñÂ§±Êïó");
      }
    };

    // ========== Ë§áË£ΩÂäüËÉΩ ==========
    document.getElementById('copyBtn').onclick = async function() {
      try {
        await navigator.clipboard.writeText(codeInput.value);
        alert('Â∑≤Ë§áË£Ω');
      } catch (e) {
        alert('Ë§áË£ΩÂ§±Êïó');
      }
    };

    // ========== Ê∏ÖÁ©∫ÂäüËÉΩ ==========
    document.getElementById('clearBtn').onclick = function() {
      codeInput.value = '';
      previewFrame.srcdoc = '';
    };

    // ========== Ê≠∑Âè≤Á¥ÄÈåÑ ==========
    function extractTitle(html) {
      const match = html.match(/<title[^>]*>(.*?)<\/title>/i);
      if (match && match[1]) {
        return match[1].trim();
      }
      return `Á®ãÂºèÁ¢º_${new Date().toLocaleDateString('zh-TW')}`;
    }

    function addToHistory(code) {
      if (!code.trim()) return;
      let history = JSON.parse(localStorage.getItem('htmlSandbox_history') || '[]');
      const name = extractTitle(code);
      const time = new Date().toLocaleString('zh-TW');
      
      if (history.length && history[0].code === code) return;
      
      history.unshift({ name, code, time });
      while (history.length > 20) history.pop();
      
      localStorage.setItem('htmlSandbox_history', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory() {
      const history = JSON.parse(localStorage.getItem('htmlSandbox_history') || '[]');
      
      if (!history.length) {
        historyList.innerHTML = '<div class="empty-state">Êö´ÁÑ°Á¥ÄÈåÑ</div>';
        return;
      }
      
      historyList.innerHTML = history.map((item, idx) => `
        <li class="history-item">
          <div class="history-info">
            <div class="history-title">${escapeHtml(item.name)}</div>
            <div class="history-meta">${item.time}</div>
          </div>
          <div class="history-actions">
            <button class="func-btn" onclick="loadHistoryItem(${idx})">‰ΩøÁî®</button>
            <button class="func-btn" onclick="deleteHistoryItem(${idx})">Âà™Èô§</button>
          </div>
        </li>
      `).join('');
    }

    window.loadHistoryItem = function(idx) {
      const history = JSON.parse(localStorage.getItem('htmlSandbox_history') || '[]');
      if (history[idx]) {
        codeInput.value = history[idx].code;
        switchTab(0);
      }
    };

    window.deleteHistoryItem = function(idx) {
      let history = JSON.parse(localStorage.getItem('htmlSandbox_history') || '[]');
      history.splice(idx, 1);
      localStorage.setItem('htmlSandbox_history', JSON.stringify(history));
      renderHistory();
    };

    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, m => map[m]);
    }

    document.getElementById('clearAllHistoryBtn').onclick = function() {
      if (confirm('Á¢∫ÂÆöÊ∏ÖÁ©∫ÊâÄÊúâÁ¥ÄÈåÑÔºü')) {
        localStorage.removeItem('htmlSandbox_history');
        renderHistory();
      }
    };

    // ÂàùÂßãËºâÂÖ•Ê≠∑Âè≤
    renderHistory();
  </script>
</body>
</html>
