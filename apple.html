<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="æ•´åˆå·¥å…·">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%231a1a1a' width='192' height='192'/><text x='96' y='130' font-size='80' text-anchor='middle' fill='%234CAF50'>ğŸ”§</text></svg>">
<link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%22%E6%95%B4%E5%90%88%E5%B7%A5%E5%85%B7%22%2C%22short_name%22%3A%22%E5%B7%A5%E5%85%B7%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22theme_color%22%3A%22%231a1a1a%22%2C%22background_color%22%3A%22%231a1a1a%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%3Csvg xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg' viewBox%3D'0 0 192 192'%3E%3Crect fill%3D'%25231a1a1a' width%3D'192' height%3D'192'%2F%3E%3Ctext x%3D'96' y%3D'130' font-size%3D'80' text-anchor%3D'middle' fill%3D'%25234CAF50'%3E%F0%9F%94%A7%3C%2Ftext%3E%3C%2Fsvg%3E%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%7D%5D%7D">
<title>æ•´åˆå·¥å…·</title>
<style>
/* CSS è¨­è¨ˆç³»çµ± */
:root {
  /* é¡è‰²ç³»çµ± - åŸºæ–¼æ·±è‰²ä¸»é¡Œ */
  --color-bg-primary: #1a1a1a;
  --color-bg-secondary: #242424;
  --color-bg-tertiary: #2a2a2a;
  --color-bg-card: #2f2f2f;
  --color-border: #3a3a3a;
  --color-border-light: #444444;
  --color-text-primary: #ffffff;
  --color-text-secondary: #b0b0b0;
  --color-text-tertiary: #808080;
  
  /* åˆ†é¡é¡è‰² */
  --color-integrate: #FF8A80;
  --color-tattoo: #82B1FF;
  --color-energy: #FFD54F;
  --color-record: #69F0AE;
  
  /* é–“è·ç³»çµ± */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 12px;
  --spacing-lg: 16px;
  --spacing-xl: 24px;
  --spacing-2xl: 32px;
  
  /* å­—é«”ç³»çµ± */
  --font-size-xs: 12px;
  --font-size-sm: 14px;
  --font-size-base: 16px;
  --font-size-md: 18px;
  --font-size-lg: 20px;
  --font-size-xl: 24px;
  
  /* åœ“è§’ç³»çµ± */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 20px;
  --radius-full: 50%;
  
  /* é™°å½±ç³»çµ± */
  --shadow-sm: 0 2px 4px rgba(0,0,0,0.2);
  --shadow-md: 0 4px 8px rgba(0,0,0,0.3);
  --shadow-lg: 0 8px 16px rgba(0,0,0,0.4);
  
  /* éæ¸¡æ•ˆæœ */
  --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* å…¨å±€æ¨£å¼ */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
  background: var(--color-bg-primary);
  color: var(--color-text-secondary);
  font-size: var(--font-size-base);
  line-height: 1.5;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  padding-bottom: 80px;
}

/* é ­éƒ¨å€åŸŸ */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-lg);
  background: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
  background: rgba(36, 36, 36, 0.95);
}

.header-left {
  color: var(--color-text-primary);
  font-size: var(--font-size-md);
  font-weight: 500;
  cursor: pointer;
}

.header-center {
  color: var(--color-text-primary);
  font-size: var(--font-size-lg);
  font-weight: 600;
}

.header-right {
  color: var(--color-text-primary);
  font-size: var(--font-size-xl);
  cursor: pointer;
  transition: transform var(--transition-fast);
}

.header-right:active {
  transform: scale(0.9);
}

/* æœç´¢æ¬„ */
.search-container {
  padding: var(--spacing-lg);
  background: var(--color-bg-secondary);
}

.search-box {
  display: flex;
  align-items: center;
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md) var(--spacing-lg);
  gap: var(--spacing-sm);
}

.search-icon {
  font-size: var(--font-size-lg);
  color: var(--color-text-tertiary);
}

.search-input {
  flex: 1;
  background: transparent;
  border: none;
  outline: none;
  color: var(--color-text-secondary);
  font-size: var(--font-size-base);
}

.search-input::placeholder {
  color: var(--color-text-tertiary);
}

/* åˆ†é¡æ¨™ç±¤ */
.tabs-container {
  padding: var(--spacing-md) var(--spacing-lg);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  background: var(--color-bg-secondary);
}

.tabs-container::-webkit-scrollbar {
  display: none;
}

.tabs {
  display: flex;
  gap: var(--spacing-sm);
  min-width: min-content;
}

.tab {
  padding: var(--spacing-sm) var(--spacing-lg);
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  white-space: nowrap;
  cursor: pointer;
  transition: all var(--transition-base);
  user-select: none;
}

.tab.active {
  background: var(--color-bg-card);
  border-color: var(--color-border-light);
  color: var(--color-text-primary);
  font-weight: 600;
}

.tab:hover {
  background: var(--color-bg-card);
}

/* å…§å®¹å€åŸŸ */
.content {
  padding: var(--spacing-lg);
}

/* å·¥å…·å¡ç‰‡ */
.tool-card {
  background: var(--color-bg-secondary);
  border-radius: var(--radius-xl);
  padding: var(--spacing-lg);
  margin-bottom: var(--spacing-md);
  display: flex;
  align-items: center;
  gap: var(--spacing-lg);
  cursor: pointer;
  transition: all var(--transition-base);
  box-shadow: var(--shadow-md);
  min-height: 100px;
  border: 1px solid var(--color-border);
}

.tool-card:active {
  transform: scale(0.98);
  box-shadow: var(--shadow-sm);
}

.tool-card:hover {
  border-color: var(--color-border-light);
}

.tool-icon {
  width: 72px;
  height: 72px;
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  flex-shrink: 0;
}

.tool-content {
  flex: 1;
}

.tool-title {
  color: var(--color-text-primary);
  font-size: var(--font-size-md);
  font-weight: 600;
  margin-bottom: var(--spacing-xs);
}

.tool-description {
  color: var(--color-text-tertiary);
  font-size: var(--font-size-sm);
  line-height: 1.4;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.tool-arrow {
  color: var(--color-text-tertiary);
  font-size: var(--font-size-lg);
}

/* åˆ†é å…§å®¹ */
.page-section {
  display: none;
}

.page-section.active {
  display: block;
  animation: fadeIn var(--transition-base);
}

/* æ¨™ç±¤é åˆ‡æ› */
.tab-page {
  display: none;
}

.tab-page.active {
  display: block;
  animation: fadeIn var(--transition-base);
}

/* æ‰“å¡é é¢ */
#checkinTab {
  background: var(--color-bg-secondary);
  border-radius: var(--radius-xl);
  padding: var(--spacing-xl);
  margin-bottom: var(--spacing-lg);
  box-shadow: var(--shadow-md);
}

.tabs-inner {
  display: flex;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-xl);
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-lg);
  padding: var(--spacing-sm);
}

.tab-inner {
  flex: 1;
  padding: var(--spacing-md);
  text-align: center;
  cursor: pointer;
  border-bottom: 3px solid transparent;
  color: var(--color-text-tertiary);
  font-size: var(--font-size-sm);
  font-weight: 500;
  transition: all var(--transition-base);
  border-radius: var(--radius-md);
}

.tab-inner.active {
  color: var(--color-text-primary);
  background: var(--color-bg-card);
  border-bottom-color: var(--color-energy);
}

#notice {
  text-align: center;
  min-height: 24px;
  margin: var(--spacing-sm) 0;
  font-weight: bold;
  font-size: var(--font-size-md);
  animation: slideDown var(--transition-base);
}

#idleTime {
  text-align: center;
  min-height: 24px;
  margin: var(--spacing-sm) 0 var(--spacing-lg);
  color: var(--color-energy);
  font-weight: bold;
  font-size: var(--font-size-sm);
  padding: var(--spacing-xs);
  background: rgba(255, 213, 79, 0.1);
  border-radius: var(--radius-sm);
  animation: pulse 2s infinite;
}

select {
  width: 100%;
  padding: var(--spacing-md);
  font-size: var(--font-size-base);
  margin: var(--spacing-xs) 0 var(--spacing-lg);
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  color: var(--color-text-secondary);
  transition: all var(--transition-base);
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  padding-right: 35px;
}

select:focus {
  outline: none;
  border-color: var(--color-border-light);
  box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.05);
}

.button-row {
  display: flex;
  justify-content: space-between;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.button-row button {
  flex: 1;
}

button {
  padding: var(--spacing-md);
  font-size: var(--font-size-base);
  margin: var(--spacing-xs) 0;
  border-radius: var(--radius-md);
  cursor: pointer;
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  color: var(--color-text-secondary);
  font-weight: 500;
  transition: all var(--transition-base);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}

button:hover {
  border-color: var(--color-border-light);
  color: var(--color-text-primary);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

button:active {
  transform: translateY(0);
}

/* æ­·å²ç´€éŒ„ */
#entries {
  max-height: 300px;
  overflow-y: auto;
  list-style: none;
  padding: var(--spacing-sm);
  margin-top: var(--spacing-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-md);
  box-shadow: inset var(--shadow-sm);
}

#entries::-webkit-scrollbar {
  width: 6px;
}

#entries::-webkit-scrollbar-track {
  background: var(--color-bg-tertiary);
}

#entries::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 3px;
}

#entries li {
  margin-bottom: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
  padding: var(--spacing-sm) var(--spacing-xs);
  animation: fadeIn var(--transition-base);
  transition: background var(--transition-base);
  border-radius: var(--radius-sm);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

#entries li:hover {
  background: var(--color-bg-card);
}

#entries li:last-child {
  border-bottom: none;
}

/* è¡¨æ ¼ */
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: var(--spacing-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-md);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}

th, td {
  border: 1px solid var(--color-border);
  padding: var(--spacing-sm);
  text-align: center;
  transition: background var(--transition-fast);
}

th {
  background: var(--color-bg-card);
  color: var(--color-text-primary);
  font-weight: bold;
  text-transform: uppercase;
  font-size: var(--font-size-xs);
  letter-spacing: 0.5px;
}

td {
  color: var(--color-text-secondary);
}

tr:hover td {
  background: var(--color-bg-card);
}

/* å ±è¡¨è¼¸å‡º */
#reportOutput {
  max-height: 350px;
  overflow: auto;
  padding: var(--spacing-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-md);
  box-shadow: inset var(--shadow-sm);
}

#reportOutput::-webkit-scrollbar {
  width: 6px;
}

#reportOutput::-webkit-scrollbar-track {
  background: var(--color-bg-tertiary);
}

#reportOutput::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 3px;
}

h3 {
  color: var(--color-text-primary);
  font-size: var(--font-size-md);
  margin: var(--spacing-lg) 0 var(--spacing-md);
}

/* åº•éƒ¨å°èˆª */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--color-bg-secondary);
  border-top: 1px solid var(--color-border);
  display: flex;
  justify-content: space-around;
  padding: var(--spacing-sm) 0;
  z-index: 100;
  backdrop-filter: blur(10px);
  background: rgba(36, 36, 36, 0.95);
}

.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  color: var(--color-text-tertiary);
  font-size: var(--font-size-xs);
  cursor: pointer;
  transition: all var(--transition-fast);
  user-select: none;
}

.nav-item.active {
  color: var(--color-text-primary);
}

.nav-icon {
  font-size: var(--font-size-xl);
}

.nav-item:active {
  transform: scale(0.95);
}

/* å‹•ç•«æ•ˆæœ */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 600px) {
  :root {
    --font-size-base: 14px;
    --spacing-lg: 12px;
  }
  
  body {
    padding-bottom: 70px;
  }
  
  .tool-card {
    min-height: 90px;
  }
  
  .tool-icon {
    width: 64px;
    height: 64px;
    font-size: 28px;
  }
}

@media (max-width: 375px) {
  :root {
    --font-size-base: 13px;
    --spacing-lg: 10px;
  }
  
  .tool-card {
    min-height: 80px;
    padding: var(--spacing-md);
    gap: var(--spacing-md);
  }
  
  .tool-icon {
    width: 56px;
    height: 56px;
    font-size: 24px;
  }
}

/* iOS Safari å„ªåŒ– */
@supports (-webkit-touch-callout: none) {
  body {
    min-height: -webkit-fill-available;
  }
}

.hidden {
  display: none !important;
}
</style>
</head>
<body>

<!-- é ­éƒ¨ -->
<div class="header">
  <div class="header-left" onclick="switchPage('history')">æ­·å²</div>
  <div class="header-center">åˆ†é¡</div>
  <div class="header-right" onclick="toggleMenu()">â˜°</div>
</div>

<!-- æœç´¢æ¬„ -->
<div class="search-container">
  <div class="search-box">
    <div class="search-icon">ğŸ”</div>
    <input type="text" class="search-input" placeholder="æœå°‹" id="searchInput" oninput="handleSearch()">
  </div>
</div>

<!-- åˆ†é¡æ¨™ç±¤ -->
<div class="tabs-container">
  <div class="tabs" id="tabsContainer">
    <div class="tab active" onclick="filterTab('integrate')">æ•´åˆ</div>
    <div class="tab" onclick="filterTab('tattoo')">åˆºé’</div>
    <div class="tab" onclick="filterTab('energy')">èƒ½é‡</div>
    <div class="tab" onclick="filterTab('record')">ç´€éŒ„</div>
  </div>
</div>

<!-- å…§å®¹å€åŸŸ -->
<div class="content" id="mainContent">
  
  <!-- æ•´åˆé é¢ -->
  <div id="integratePage" class="page-section active">
    <div id="toolsList"></div>
  </div>

  <!-- æ‰“å¡é é¢ -->
  <div id="checkinPage" class="page-section" style="display:none;">
    <div id="checkinTab">
      <div class="tabs-inner">
        <div class="tab-inner active" onclick="switchCheckinTab(0)">ğŸ“Œ æ‰“å¡</div>
        <div class="tab-inner" onclick="switchCheckinTab(1)">ğŸ“Š å ±è¡¨</div>
      </div>

      <div id="checkinContent">
        <div id="notice"></div>
        <div id="idleTime"></div>

        <select id="task">
          <option>ğŸ¨ ç•«ç•«</option>
          <option>ğŸ›Œ ä¼‘æ¯</option>
          <option>ğŸ–‹ åˆºé’</option>
          <option>ğŸƒ é‹å‹•</option>
          <option>ğŸ¥ æ‹ç‰‡</option>
          <option>ğŸ“– å¾©ç›¤</option>
          <option>ğŸ› æ´—æ¾¡</option>
          <option>ğŸš åƒé£¯</option>
          <option>ğŸ§¹ æ•´ç†</option>
          <option>ğŸ’ª ç·´åŠŸ</option>
          <option>ğŸ§˜ å…§åœ¨</option>
          <option>ğŸŒ å¤–åœ¨</option>
          <option>ğŸ‘¥ å®¢æº</option>
          <option>ğŸ“ è¦åŠƒ</option>
          <option>ğŸ’° è¨˜å¸³</option>
        </select>

        <div class="button-row">
          <button onclick="startTask()">â–¶ï¸ é–‹å§‹ä»»å‹™</button>
          <button onclick="endTask()">â¹ çµæŸä»»å‹™</button>
        </div>

        <h3>ğŸ“… æ™‚é–“è¦åŠƒ</h3>
        <ul id="entries"></ul>
      </div>

      <div id="reportContent" style="display:none;">
        <button onclick="generateDailyReport()">ğŸ“… ç”Ÿæˆä»Šæ—¥å ±è¡¨</button>
        <button onclick="copyReport()">ğŸ“‹ è¤‡è£½å ±è¡¨</button>
        <h3>ä»Šæ—¥å ±è¡¨</h3>
        <div id="reportOutput"></div>
      </div>
    </div>

    <div style="max-width: 450px; margin: var(--spacing-xl) auto; padding: var(--spacing-lg); text-align: center; border: 2px solid #ff6666; border-radius: var(--radius-lg); background: var(--color-bg-secondary); box-shadow: var(--shadow-md);">
      <h3 style="color: #ff6666; margin-bottom: var(--spacing-md);">ğŸ—‘ æ¸…ç©ºç´€éŒ„</h3>
      <button onclick="clearAllData()">æ¸…ç©ºå…¨éƒ¨ç´€éŒ„</button>
      <p id="status" style="margin-top: var(--spacing-md); font-weight: bold; color: lightgreen;"></p>
    </div>
  </div>

  <!-- åˆºé’é é¢ -->
  <div id="tattooPage" class="page-section" style="display:none;">
    <div style="text-align: center; padding: var(--spacing-xl);">
      <p style="color: var(--color-text-tertiary); font-size: var(--font-size-lg);">åˆºé’é é¢</p>
      <p style="color: var(--color-text-tertiary); margin-top: var(--spacing-lg);">æ‚¨å¯ä»¥åœ¨æ­¤æ·»åŠ åˆºé’ç›¸é—œå·¥å…·</p>
    </div>
  </div>

  <!-- èƒ½é‡é é¢ -->
  <div id="energyPage" class="page-section" style="display:none;">
    <div style="text-align: center; padding: var(--spacing-xl);">
      <p style="color: var(--color-text-tertiary); font-size: var(--font-size-lg);">èƒ½é‡é é¢</p>
      <p style="color: var(--color-text-tertiary); margin-top: var(--spacing-lg);">æ‚¨å¯ä»¥åœ¨æ­¤æ·»åŠ èƒ½é‡ç›¸é—œå·¥å…·</p>
    </div>
  </div>

  <!-- ç´€éŒ„é é¢ -->
  <div id="recordPage" class="page-section" style="display:none;">
    <div style="text-align: center; padding: var(--spacing-xl);">
      <p style="color: var(--color-text-tertiary); font-size: var(--font-size-lg);">ç´€éŒ„é é¢</p>
      <p style="color: var(--color-text-tertiary); margin-top: var(--spacing-lg);">æ‚¨å¯ä»¥åœ¨æ­¤æ·»åŠ ç´€éŒ„ç›¸é—œå·¥å…·</p>
    </div>
  </div>

</div>

<!-- åº•éƒ¨å°èˆª -->
<div class="bottom-nav">
  <div class="nav-item active" onclick="switchMainTab('integrate')">
    <div class="nav-icon">ğŸ“¦</div>
    <div>æ•´åˆ</div>
  </div>
  <div class="nav-item" onclick="switchMainTab('tattoo')">
    <div class="nav-icon">ğŸ–‹</div>
    <div>åˆºé’</div>
  </div>
  <div class="nav-item" onclick="switchMainTab('energy')">
    <div class="nav-icon">âš¡</div>
    <div>èƒ½é‡</div>
  </div>
  <div class="nav-item" onclick="switchMainTab('record')">
    <div class="nav-icon">ğŸ“</div>
    <div>ç´€éŒ„</div>
  </div>
</div>

<script>
// ============ localStorage ç®¡ç† ============
const STORAGE_KEYS = {
  TASK_ENTRIES: 'integrateTool_taskEntries',
  TOOLS_LIST: 'integrateTool_toolsList',
  SETTINGS: 'integrateTool_settings',
  HISTORY: 'integrateTool_history'
};

// é è¨­å·¥å…·åˆ—è¡¨
const DEFAULT_TOOLS = [
  {
    id: 'checkin',
    title: 'æ¯æ—¥æ‰“å¡',
    category: 'integrate',
    description: 'è¨˜éŒ„æ¯æ—¥ä»»å‹™æ™‚é–“ï¼Œç”Ÿæˆå·¥ä½œå ±è¡¨',
    icon: 'âœ…',
    color: '#FF8A80'
  },
  {
    id: 'tool2',
    title: 'å·¥å…·2',
    category: 'integrate',
    description: 'è‡ªè¨‚å·¥å…·èªªæ˜',
    icon: 'ğŸ”§',
    color: '#82B1FF'
  },
  {
    id: 'tool3',
    title: 'å·¥å…·3',
    category: 'integrate',
    description: 'è‡ªè¨‚å·¥å…·èªªæ˜',
    icon: 'ğŸ“Š',
    color: '#FFD54F'
  },
  {
    id: 'tool4',
    title: 'å·¥å…·4',
    category: 'integrate',
    description: 'è‡ªè¨‚å·¥å…·èªªæ˜',
    icon: 'âš™ï¸',
    color: '#69F0AE'
  },
  {
    id: 'tool5',
    title: 'å·¥å…·5',
    category: 'integrate',
    description: 'è‡ªè¨‚å·¥å…·èªªæ˜',
    icon: 'ğŸ¯',
    color: '#B388FF'
  },
  {
    id: 'tool6',
    title: 'å·¥å…·6',
    category: 'integrate',
    description: 'è‡ªè¨‚å·¥å…·èªªæ˜',
    icon: 'ğŸ’¡',
    color: '#64B5F6'
  },
  {
    id: 'tool7',
    title: 'å·¥å…·7',
    category: 'integrate',
    description: 'è‡ªè¨‚å·¥å…·èªªæ˜',
    icon: 'ğŸš€',
    color: '#FF8A65'
  },
  {
    id: 'tool8',
    title: 'å·¥å…·8',
    category: 'integrate',
    description: 'è‡ªè¨‚å·¥å…·èªªæ˜',
    icon: 'ğŸ“±',
    color: '#FFD740'
  }
];

// ============ åˆå§‹åŒ– ============
function initApp() {
  loadTools();
  loadSettings();
  loadHistory();
}

// ============ å·¥å…·ç®¡ç† ============
function loadTools() {
  let tools = localStorage.getItem(STORAGE_KEYS.TOOLS_LIST);
  if (!tools) {
    tools = DEFAULT_TOOLS;
    saveTools(tools);
  } else {
    tools = JSON.parse(tools);
  }
  renderTools(tools);
}

function saveTools(tools) {
  localStorage.setItem(STORAGE_KEYS.TOOLS_LIST, JSON.stringify(tools));
}

function renderTools(tools) {
  const toolsList = document.getElementById('toolsList');
  toolsList.innerHTML = '';
  
  tools.forEach(tool => {
    const card = document.createElement('div');
    card.className = 'tool-card fade-in';
    card.onclick = () => openTool(tool.id);
    
    card.innerHTML = `
      <div class="tool-icon" style="background: linear-gradient(135deg, ${tool.color} 0%, ${adjustColor(tool.color, -20)} 100%);">
        ${tool.icon}
      </div>
      <div class="tool-content">
        <div class="tool-title">${tool.title}</div>
        <div class="tool-description">${tool.description}</div>
      </div>
      <div class="tool-arrow">â€º</div>
    `;
    
    toolsList.appendChild(card);
  });
}

function adjustColor(color, amount) {
  const col = parseInt(color.slice(1), 16);
  const num = Math.round(Math.max(0, Math.min(255, (col & 0xFF) + amount))) |
              (Math.round(Math.max(0, Math.min(255, (col >> 8 & 0xFF) + amount))) << 8) |
              (Math.round(Math.max(0, Math.min(255, (col >> 16 & 0xFF) + amount))) << 16);
  return '#' + num.toString(16).padStart(6, '0');
}

function openTool(toolId) {
  if (toolId === 'checkin') {
    switchMainTab('integrate');
    switchPage('checkin');
  } else {
    alert(`æ‰“é–‹å·¥å…·: ${toolId}\n\næ‚¨å¯ä»¥åœ¨æ­¤é€£æ¥å…¶ä»–HTMLé é¢`);
  }
}

// ============ é é¢åˆ‡æ› ============
function switchMainTab(tab) {
  const navItems = document.querySelectorAll('.nav-item');
  navItems.forEach(item => item.classList.remove('active'));
  event.currentTarget.classList.add('active');
  
  const sections = document.querySelectorAll('.page-section');
  sections.forEach(section => section.style.display = 'none');
  
  switch(tab) {
    case 'integrate':
      document.getElementById('integratePage').style.display = 'block';
      break;
    case 'tattoo':
      document.getElementById('tattooPage').style.display = 'block';
      break;
    case 'energy':
      document.getElementById('energyPage').style.display = 'block';
      break;
    case 'record':
      document.getElementById('recordPage').style.display = 'block';
      break;
  }
}

function switchPage(page) {
  if (page === 'checkin') {
    document.getElementById('integratePage').style.display = 'none';
    document.getElementById('checkinPage').style.display = 'block';
  } else if (page === 'history') {
    alert('æ­·å²é é¢åŠŸèƒ½');
  }
}

function switchCheckinTab(index) {
  const tabs = document.querySelectorAll('.tab-inner');
  tabs.forEach((tab, i) => {
    tab.classList.toggle('active', i === index);
  });
  
  const checkinContent = document.getElementById('checkinContent');
  const reportContent = document.getElementById('reportContent');
  
  if (index === 0) {
    checkinContent.style.display = 'block';
    reportContent.style.display = 'none';
  } else {
    checkinContent.style.display = 'none';
    reportContent.style.display = 'block';
  }
}

// ============ åˆ†é¡éæ¿¾ ============
function filterTab(category) {
  const tabs = document.querySelectorAll('.tab');
  tabs.forEach(tab => tab.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

// ============ æœç´¢åŠŸèƒ½ ============
function handleSearch() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  let tools = JSON.parse(localStorage.getItem(STORAGE_KEYS.TOOLS_LIST) || '[]');
  
  if (!searchTerm) {
    renderTools(tools);
    return;
  }
  
  const filtered = tools.filter(tool => 
    tool.title.toLowerCase().startsWith(searchTerm) ||
    tool.description.toLowerCase().includes(searchTerm)
  );
  
  renderTools(filtered);
}

// ============ æ‰“å¡åŠŸèƒ½ ============
let currentTask = null;
let startTime = null;

const entriesEl = document.getElementById("entries");
const noticeEl = document.getElementById("notice");
const idleEl = document.getElementById("idleTime");

function showNotice(text, color = "lightgreen") {
  noticeEl.textContent = text;
  noticeEl.style.color = color;
  setTimeout(() => {
    noticeEl.textContent = "";
  }, 2000);
}

function formatDuration(ms) {
  let sec = Math.floor(ms / 1000);
  let h = Math.floor(sec / 3600);
  let m = Math.floor((sec % 3600) / 60);
  let s = sec % 60;
  return `${h}å°æ™‚${m}åˆ†${s}ç§’`;
}

function loadEntries() {
  const data = JSON.parse(localStorage.getItem(STORAGE_KEYS.TASK_ENTRIES) || "[]");
  entriesEl.innerHTML = "";
  
  data.slice().reverse().forEach(entry => {
    const li = document.createElement("li");
    if (entry.end) {
      li.innerHTML = `${entry.task}<br>ã€€${entry.start} â†’ ${entry.end} | ${entry.duration}`;
    } else {
      li.innerHTML = `${entry.task}<br>ã€€${entry.start} â†’ (é€²è¡Œä¸­...)`;
      currentTask = entry.task;
      startTime = new Date(entry.startDate || entry.start);
    }
    entriesEl.appendChild(li);
  });
  
  updateIdleTime();
}

function startTask() {
  if (currentTask) {
    showNotice("è«‹å…ˆçµæŸç•¶å‰ä»»å‹™ï¼", "red");
    return;
  }
  
  currentTask = document.getElementById("task").value;
  startTime = new Date();
  
  let entries = JSON.parse(localStorage.getItem(STORAGE_KEYS.TASK_ENTRIES) || "[]");
  entries.push({
    task: currentTask,
    start: startTime.toLocaleTimeString(),
    startDate: startTime.toISOString(),
    end: null,
    duration: null,
    ms: null
  });
  
  localStorage.setItem(STORAGE_KEYS.TASK_ENTRIES, JSON.stringify(entries));
  loadEntries();
  showNotice(`â–¶ï¸ ä»»å‹™ "${currentTask}" å·²é–‹å§‹`);
}

function endTask() {
  if (!currentTask) {
    showNotice("å°šæœªé–‹å§‹ä»»å‹™ï¼", "red");
    return;
  }
  
  const endTime = new Date();
  const durationMs = endTime - startTime;
  
  let entries = JSON.parse(localStorage.getItem(STORAGE_KEYS.TASK_ENTRIES) || "[]");
  let lastEntry = entries.slice().reverse().find(e => !e.end);
  
  if (lastEntry) {
    lastEntry.end = endTime.toLocaleTimeString();
    lastEntry.ms = durationMs;
    lastEntry.duration = formatDuration(durationMs);
    
    localStorage.setItem(STORAGE_KEYS.TASK_ENTRIES, JSON.stringify(entries));
    
    currentTask = null;
    startTime = null;
    loadEntries();
    showNotice(`â¹ ä»»å‹™å·²çµæŸ | æ™‚é•·ï¼š${formatDuration(durationMs)}`);
  } else {
    showNotice("æœªæ‰¾åˆ°é€²è¡Œä¸­ä»»å‹™", "red");
  }
}

function updateIdleTime() {
  if (currentTask) {
    idleEl.textContent = "";
    return;
  }
  
  const now = new Date();
  const startOfDay = new Date();
  startOfDay.setHours(0, 0, 0, 0);
  
  let idleMs = now - startOfDay;
  
  const data = JSON.parse(localStorage.getItem(STORAGE_KEYS.TASK_ENTRIES) || "[]");
  data.forEach(entry => {
    if (entry.ms) {
      idleMs -= entry.ms;
    }
  });
  
  if (idleMs < 0) idleMs = 0;
  idleEl.textContent = `â³ ä»Šæ—¥é–’ç½®æ™‚é–“ï¼š${formatDuration(idleMs)}`;
}

setInterval(updateIdleTime, 1000);

// ============ å ±è¡¨åŠŸèƒ½ ============
function generateDailyReport() {
  const data = JSON.parse(localStorage.getItem(STORAGE_KEYS.TASK_ENTRIES) || "[]");
  
  if (!data.length) {
    alert("ç„¡ç´€éŒ„");
    return;
  }
  
  const taskMap = {};
  let totalSec = 0;
  
  data.forEach(entry => {
    if (entry.ms) {
      const task = entry.task;
      const seconds = Math.floor(entry.ms / 1000);
      taskMap[task] = (taskMap[task] || 0) + seconds;
      totalSec += seconds;
    }
  });
  
  const idleSec = 24 * 3600 - totalSec;
  
  let html = "<table><tr><th>ä»»å‹™</th><th>ç´¯è¨ˆæ™‚é•·</th></tr>";
  
  for (const task in taskMap) {
    html += `<tr><td>${task}</td><td>${formatDuration(taskMap[task] * 1000)}</td></tr>`;
  }
  
  html += `<tr><td><b>ç¸½æ™‚é•·</b></td><td>${formatDuration(totalSec * 1000)}</td></tr>`;
  html += `<tr><td><b>é–’ç½®æ™‚é–“</b></td><td>${formatDuration(idleSec * 1000)}</td></tr>`;
  html += "</table>";
  
  document.getElementById("reportOutput").innerHTML = html;
  showNotice("âœ… ä»Šæ—¥å ±è¡¨å·²ç”Ÿæˆ");
}

function copyReport() {
  const el = document.getElementById("reportOutput");
  if (!el.innerText) {
    alert("ç„¡å ±è¡¨å¯è¤‡è£½");
    return;
  }
  
  navigator.clipboard.writeText(el.innerText)
    .then(() => {
      showNotice("âœ… å ±è¡¨å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿");
    })
    .catch(() => {
      showNotice("âŒ è¤‡è£½å¤±æ•—", "red");
    });
}

function clearAllData() {
  if (confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ‰“å¡ç´€éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼")) {
    localStorage.removeItem(STORAGE_KEYS.TASK_ENTRIES);
    document.getElementById("status").textContent = "âœ… å…¨éƒ¨ç´€éŒ„å·²æ¸…ç©º";
    setTimeout(() => {
      location.reload();
    }, 500);
  }
}

// ============ å…¶ä»–åŠŸèƒ½ ============
function loadSettings() {
  const settings = localStorage.getItem(STORAGE_KEYS.SETTINGS);
  if (settings) {
    console.log('è¨­å®šå·²è¼‰å…¥:', JSON.parse(settings));
  }
}

function loadHistory() {
  const history = localStorage.getItem(STORAGE_KEYS.HISTORY);
  if (history) {
    console.log('æ­·å²å·²è¼‰å…¥:', JSON.parse(history));
  }
}

function toggleMenu() {
  alert('é¸å–®åŠŸèƒ½\n\nå¯ä»¥åœ¨æ­¤æ·»åŠ ï¼š\n- é—œæ–¼\n- è¨­å®š\n- å¹«åŠ©\n- åé¥‹');
}

// ============ åˆå§‹åŒ–æ‡‰ç”¨ ============
window.addEventListener('DOMContentLoaded', () => {
  initApp();
  loadEntries();
});

document.addEventListener('visibilitychange', () => {
  if (!document.hidden) {
    loadEntries();
  }
});
</script>

</body>
</html>
